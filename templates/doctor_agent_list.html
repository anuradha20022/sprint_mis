{% extends 'base.html'%}
{%  block content_heading %}Doctor Agent List {% endblock %}
{%  block content_subheading %}Doctor Agent List {% endblock %}
{% block title %} Doctor Agent List{% endblock %}

#retieve data from database using ajax jquery
{% block script %}
    <script>
        {#$('#DataTables_Table_0').dataTable().clear().destroy();#}
        {#$('#cus-responsive-datatable').dataTable().clear().destroy();#}
        $('#cus-responsive-datatable').DataTable({
            serverSide: true,
            processing: true,
            select: true,
            paging: true,
            lengthChange: true,
            "pageLength": 10,
            {#"lengthMenu": [[13, 25, 50, -1], [13, 25, 50, "All"]],#}
            searching: true,
            info: true, // bottom left info
            responsive: true, // responnsive table
            {#"deferRender": true,#}
            ajax: {
                url: "{% url 'doctor_agent_list_dt' %}",
                type: "POST",
            },

            columns:[
                {data: "sno"},
                {#{data: "input"},#}
                {data: "emp_id"},
                {data: "unique_id"},
                {data: "agent_name"},
                {data: "mobile"},
                {data: "branch"},
                {data: "agent_type"},
                {data: "category"},
                {data: "company"},
                {data: "pancard"},
                {data: "bank_ac"},
                {data: "ifsc"},
                {#{data: "area"},#}
                {#{data: "city"},#}
                {#{data: "district"},#}
                {data: "state"},
                {data: "pincode"},
                {data: "date"},
                {#{data: "source"},#}
                {data: "type"},
                {data: "r_status"},
                {data: "designation"},
                {#{data: "department"},#}
            ],
        });

        {#$('#cus-responsive-datatable_wrapper').removeClass('dataTables_wrapper container-fluid dt-bootstrap4 no-footer');#}

        var agent_list;

            $('#transfer_form').on('submit', function (e) {
            e.preventDefault();
            {#let agent_list = $("input[name='transfer_id']:checked").val();#}
            agent_list = $("input[name='transfer_id']:checked").map(function () {
                return this.value;
            }).get();
            if (agent_list.length>0){
                $('#transfer_modal').modal('show');
                $('#doctor_agent_count').html(agent_list.length);
            }
            else {
                swal("Warning!", "No rows selected!", "warning");
            }
        });


        $('#transfer_save_form').on('submit', function (e) {
            e.preventDefault();
            let formData = new FormData(this);
            formData.append('agent_uids', agent_list);
            $.ajax({
                type: "POST",
                url: "{% url 'save_transfer' %}",
                data: formData,
                success: function (res) {
                    console.log(res);
                    if (res.res) {
                        $('#transfer_save_form').trigger('reset');
                        $('#transfer_modal').modal('hide');
                        location.reload();
                    }
                },
                error: function (error) {

                },
                processData: false,
                contentType: false,
                cache: false,
        })
        });


        $('#select_all').on('click', function () {
            let agent_list = $("input[name='transfer_id']:checked");
            if (agent_list.length>0){
                $("input[name='transfer_id']").prop("checked", false)
            }
            else {
                $("input[name='transfer_id']").prop("checked", true);
            }

        });



    </script>
{% endblock %}
{% block body %}
    <style>

    .ui-autocomplete{
        z-index: 999999;
    }
    .table td{
        {#font-size: 12px!important;#}
        padding: 5px!important;
    }
.table-responsive {
  display: block;
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.table-responsive > .table-bordered {
  border: 0;
}
    .dataTables_wrapper {
        padding: 0!important;
    }
    </style>
 <form action="" method="POST" autocomplete="off">
 {% csrf_token %}
     <div class="row">
         <div class="col-md-3">
             <div class="form-group">
                 <select class="form-control" name="branch">
                     <option value="" >-- Select Branch --</option>
                     <option value="All" >All</option>
                     {% for list in branch %}
                         <option value="{{ list.branch_name }}">{{ list.branch_name }}</option>

                     {% endfor %}
                 </select>
             </div>
         </div>
         <div class="col-md-4">
             <div class="form-group">
                 <input type="text" class="form-control" name="empid" id="doctor_id_search" placeholder="Enter Unique ID or Agent Name">

             </div>
         </div>
             <div class="col-md-2">
                 <button type="submit" name="Submit" class="btn btn-lg btn-success btn-gradient btn-shadow">Submit</button>
             </div>
         <div class="col-md-2">
             <button type="button" name="Submit" class="btn btn-lg btn-warning btn-gradient btn-shadow" data-toggle="modal" data-target="#transfer_all">Transfer</button>
         </div>

{#         <div class="col-md-3">#}
{#             <button type="button" name="Submit" class="btn btn-lg btn-success" onclick="$('#all_data').toggle('hide'); $('#inactive_data').toggle('show')">Inactive list</button>#}
{#         </div>#}
     </div>

     <div class="modal fade" id="transfer_all">
         <div class="modal-dialog modal-dialog-centered">
             <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Transfer All Doctor Agent</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    </div>
                    <form action="{% url 'save_transfer' %}" method="post" autocomplete="off">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-12">
                                <div class="modal-body">

                                        <div class="form-group row">
                                            <label class="col-12 col-form-label">Transfer From</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" name="from_empid" id="transfer_search_id1" placeholder="Eg. 010215">
                                            </div>
                                        </div>

                                        <div class="form-group row">
                                            <label class="col-12 col-form-label">Transfer To</label>
                                            <div class="col-12">
                                                <input type="text" class="form-control" name="to_empid" id="transfer_search_id2" placeholder="Eg. 010215">
                                            </div>
                                        </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-success">Save changes</button>
                                </div>
                            </div>
                        </div>
                    </form>
         </div>
     </div>
     </div>

 </form>

{#    {% if doctor_agent_list %}#}
        <form id="transfer_form" method="post">
        {% csrf_token %}
            <div class="row pb-4">
                <div class="col-md-12">
                    <div class="card card-body">
                    <div class="text-right">
                    <button type="submit" name="Submit" class="btn btn-success btn-gradient btn-shadow">Transfer</button>
                    </div><hr>
                        <div class="table-responsive">
                            <table id="" class="table table-striped table-bordered cus-responsive-datatable" style="white-space: nowrap">
                                <thead>
                                <tr role="row" style="background: #0e43b5; color:white">
                                    <th class="py-2" data-orderable="false">#</th>
                                    <th class="py-2" data-orderable="false"><i class="fa fa-check-circle font-20" id="select_all"></i> </th>
                                    <th class="py-2" data-orderable="false">Emp ID</th>
                                    <th class="py-2" data-orderable="false">Unique ID</th>
                                    <th class="py-2" data-orderable="false">Agent Name</th>
                                    <th class="py-2" data-orderable="false">Mobile</th>
                                    <th class="py-2" data-orderable="false">Branch</th>
                                    <th class="py-2" data-orderable="false">Agent Type</th>
                                    <th class="py-2" data-orderable="false">Category</th>
                                    <th class="py-2" data-orderable="false">Company</th>
                                    <th class="py-2" data-orderable="false">Pan Card</th>
                                    <th class="py-2" data-orderable="false">Bank Act</th>
                                    <th class="py-2" data-orderable="false">IFSC</th>
                                    <th class="py-2" data-orderable="false">Area</th>
                                    <th class="py-2" data-orderable="false">City</th>
                                    <th class="py-2" data-orderable="false">Date</th>
                                    <th class="py-2" data-orderable="false">Type</th>
                                    <th class="py-2" data-orderable="false">R_Status</th>
                                    <th class="py-2" data-orderable="false">Designation</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for agents in doctor_agent_list %}
                                    <tr>
                                        <td class="py-1 text-right">{{ forloop.counter }}</td>
                                        <td class="py-1">
                                            <div class="custom-control custom-checkbox custom-checkbox-1">
{#                                                <input type="checkbox" class="custom-control-input" id="Credit">#}
                                                <input type="checkbox" class="custom-control-input" name="transfer_id" id="{{ agents.unique_id }}" value="{{ agents.unique_id }}">
                                                <label class="custom-control-label" for="{{ agents.unique_id }}"></label>
                                            </div>
                                        </td>
                                        <td class="py-1">{{ agents.emp_id }}</td>
                                        <td class="py-1">{{ agents.unique_id }}</td>
                                        <td class="py-1">{{ agents.agent_name }}</td>
                                        <td class="py-1">{{ agents.mobile }}</td>
                                        <td class="py-1">{{ agents.branch }}</td>
                                        <td class="py-1">{{ agents.agent_type }}</td>
                                        <td class="py-1">{{ agents.category }}</td>
                                        <td class="py-1">{{ agents.company }}</td>
                                        <td class="py-1">{{ agents.pancard }}</td>
                                        <td class="py-1">{{ agents.bank_ac }}</td>
                                        <td class="py-1">{{ agents.ifsc }}</td>
                                        <td class="py-1">{{ agents.area }}</td>
                                        <td class="py-1">{{ agents.city }}</td>
                                        <td class="py-1">{{ agents.date }}</td>
                                        <td class="py-1">{{ agents.type }}</td>
                                        <td class="py-1">{{ agents.r_status }}</td>
                                        <td class="py-1">{{ agents.designation }}</td>
                                    </tr>
                                {% endfor %}

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </form>

        <!-- Modal -->
        <div class="modal fade" id="transfer_modal">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Transfer Doctor Agent</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    </div>
                    <form id="transfer_save_form " method="post">
                        {% csrf_token %}
                        <div class="row">
                            <div class="col-md-12">
                                <div class="modal-body">
                                        <h4>Doctor Agent Count : <span id="doctor_agent_count"></span> </h4>
                                        <div class="form-group">
                                            <input type="text" class="form-control" name="empid" id="doctorid_search" placeholder="Eg. 010215">
                                        </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-success">Save changes</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

{% endblock %}
