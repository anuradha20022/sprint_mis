{% extends 'base.html'%}
{%  block content_heading %} Admission List {% endblock %}
{%  block content_subheading %} AdmissionList {% endblock %}
{% block title %} Admission List {% endblock %}

{% block script %}
<script>


$(".edit-admission").on('click', function () {
        let edit_value = $(this).data('adm');
        console.log(edit_value);
        $.ajax({
            url: '{% url 'admission_list' %}',
            data: {sno: edit_value},
            success: function (response) {
                $('#invoice_no').html(response.invoice_no);
                $('#patient_name').html(response.patient_name);
                $('#department_name').html(response.department_name);
                $('#consultant').html(response.consultant);
                $('#referralname').html(response.referralname);
                $('#organization').html(response.organization);
                $('#discount').html("Rs. ",response.discount);
                $('#phar_consum_billamount').html("Rs. ",response.phar_consum_billamount);
                $('#netbill').html("Rs. ", response.netbill);
                $('#calculationType').html(response);

            },
            error: function () {
                alert('Oops something went wrong!')
            }
        })
    });
    function refferalCalculationChangeOnClick() {
            var calculationType = document.getElementById("calculationType").value;
            if (calculationType == "Percentage") {
                document.getElementById("labelPercentageValue").innerHTML = "Enter Percentage";
            }
            if (calculationType == "Value") {
                document.getElementById("labelPercentageValue").innerHTML = "Enter Value";
            }
        }
   function refferalCalculationChange() {
            var calculationType = document.getElementById("calculationType").value;
            if (calculationType == "Percentage") {
                document.getElementById("labelPercentageValue").innerHTML = "Enter Percentage";
                document.getElementById("percentageValue").value = null;
                document.getElementById("refferalAmount").value = null;
            }
            if (calculationType == "Value") {
                document.getElementById("labelPercentageValue").innerHTML = "Enter Value";
                document.getElementById("percentageValue").value = null;
                document.getElementById("refferalAmount").value = null;
            }
        }
         function refferalCalculation() {
                var calculationType = document.getElementById("calculationType").value;
                var EnteredValue = document.getElementById("percentageValue").value;
                var netAmount = document.getElementById("netAmount").innerHTML;
                var hospitalServices = document.getElementById("hospitalServices").innerHTML;
                var percentageValue = document.getElementById("percentageValue").value;
                var checkbox = document.getElementById("includePH").checked;
                if (calculationType == "Value") {
                    document.getElementById("refferalAmount").value = EnteredValue;
                }
                if (calculationType == "Percentage" && checkbox == false) {
                    var hospitals = hospitalServices.replace("Rs. ", "");
                    document.getElementById("refferalAmount").value = parseFloat(hospitals) * parseFloat(percentageValue) / 100
                }
                if (calculationType == "Percentage" && checkbox == true) {
                    var netAmounts = netAmount.replace("Rs. ", "");
                    document.getElementById("refferalAmount").value = parseFloat(netAmounts) * parseFloat(percentageValue) / 100
                }
            }


</script>
{% endblock %}

{% block body %}
<style>
.ui-autocomplete{
        z-index: 999999;
    }
</style>
    <form action="" method="post" autocomplete="on">
    {% csrf_token %}
        <div class="row">
            <div class="col-md-3">
                <div class="form-group">
                    <select class="form-control" name="branch">
                        <option value="" disabled>-- Select Branch --</option>
                        <option value="All" selected>All</option>
                        {% for list in branch %}
                            <option value="{{ list.branch_name }}">{{ list.branch_name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-3">
                <input type="text" name="datee" class="form-control daterange-shawCalRanges">
            </div>
            <div class="col-md-2">
                <button type="submit" name="Submit" class="btn btn-lg btn-primary btn-gradient btn-shadow">Submit</button>
            </div>
        </div>
    </form>



 <div class="row pb-4">
     <div class="col-md-12">
         <div class="card card-body">
          <div class="table-responsive">
           <table id="" class="table table-striped table-bordered cus-responsive-datatable" style="white-space: nowrap">
            <thead>
              <tr role="row" style="background: #3F51B5; color: #fff;">
                <th class="py-2" data-orderable="false">#</th>
                  <th class="py-2" data-orderable="false">Referral</th>
                  <th class="py-2" data-orderable="false">IP NO</th>
                  <th class="py-2" data-orderable="false">Patient Name</th>
                  <th class="py-2" data-orderable="false">Branch</th>
                  <th class="py-2" data-orderable="false">Consultant</th>
                  <th class="py-2" data-orderable="false">Admitted Type</th>
                  <th class="py-2" data-orderable="false">Organization</th>
              </tr>
            </thead>
               <tbody>
               {%  for list in admission %}
                 <tr>
                     <td class="py-2 text-right">{{ forloop.counter }}</td>
                     <td class="py-2"> <a href="#"  data-adm="{{ list.sno }}" class="icon-pencil mr-2 text-info edit-admission" data-toggle="modal" data-target="#admissionModal" onclick="changeValue()"></a></td>
                     <td class="py-2">{{ list.invoice_no }}</td>
                     <td class="py-2">{{ list.patient_name }}</td>
                     <td class="py-2">{{ list.branch }}</td>
                     <td class="py-2">{{ list.consultantentry }}</td>
                     <td class="py-2">{{ list.admissiontype}}</td>
                     <td class="py-2">{{ list.organization }}</td>

                 </tr>
               {% endfor %}
              </tbody>
        </table>
    </div>
         </div>
     </div>

    <div class="modal fade" id="admissionModal">
        <div class="modal-dialog modal-lg" style="max-width: 1100px">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="largeModalLabel">Modal title</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
                </div>
                <div class="modal-body">
                    <table class="table table-striped table-responsive">
                        <thead>
                        <tr style="white-space: nowrap">
                            <th>IP number</th>
                            <th>Gross Bill Amount</th>
                            <th>Discount Amount</th>
                            <th>Net Bill Amount</th>
                            <th>Pharmacy & Cons</th>
                            <th>Hospital Services</th>
                            <th>Bank Acc.no</th>
                            <th>IFSC Code</th>
                            <th>PAN Card</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td id="invoice_no"></td>
                            <td id="patient_name"></td>
                            <td id="department_name"></td>
                            <td id="consultant"></td>
                            <td id="referralname"></td>
                            <td id="organization"></td>
                            <td id="discounts"></td>
                            <td id="phar_consum_billamount"></td>
                            <td id="netbill"> </td>
                        </tr>
                        </tbody>
                    </table>
{#                    {% if calculationType == 'Percentage' %}#}
                     <div class="form-check mb-2">
                            <label for="includePH" class="form-check-label mr-4">Include(Pharmacy & Consumables)</label>
                            <input type="checkbox" class="form-check-input" id="includePH" onchange="refferalCalculation()">
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="referralType">Referral Type</label>
                                    <select class="form-control" name="referral_type" id="referralType">
                                        <option value="" selected>Referral</option>
                                        <option value="">Walkin</option>
                                        <option value="">Old patient</option>
                                        <option value="">Cross Referral</option>
                                        <option value="">Self</option>
                                        <option value="">Marketinf executive</option>
                                        <option value="">Visiting Consultant</option>
                                    </select>
                                </div>
                            </div>

                              <div class="col-md-9">

                                <div class="form-group">
                                    <label for="UCID">UCID</label>
                                    <input type="text" class="form-control" name="search" id="ucid_search" placeholder="Search by UCID / Name / Mobile" autocomplete="off">
                                </div>
                            </div>
                             <div class="col-md-6">
                                <div class="form-group">
                                    <label for="referralDoctor">Referral Doctor / Agent Name</label>
                                    <input type="text" class="form-control" value="{{ emp.agent_name }}" name="agent_name" id="referralDoctor" placeholder="Referral Doctor" readonly>
                                </div>
                            </div>
                             <div class="col-md-6">
                                <div class="form-group">
                                    <label for="marketingExecutive">Marketing Executive</label>
                                    <input type="text" class="form-control" value="{{emp.mobile }}" name="mobile" id="marketingExecutive" placeholder="Marketing Executive" readonly>
                                </div>
                            </div>


{#                            <div class="col-md-6">#}
{#                                <div class="form-group">#}
{#                                    <label for="referralName">Referral Name as per consultant</label>#}
{#                                    <input type="text" class="form-control" name="consultantentry" id="referralName" placeholder="Referral Name">#}
{#                                </div>#}
{#                            </div>#}
                             <div class="col-md-6">

                                <div class="form-group">
                                    <label for="calculationType">Calculation Type</label>
                                     <select class="form-control" name="referral_type" id="referralType" onchange="Change()">
                                        <option value="Value" selected>Value</option>
                                        <option value="Percentage">Percentage</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="labelPercentageValue" id="labelPercentageValue">Enter Value</label>
                                    <input type="number" class="form-control" name="percentageValue" id="percentageValue" oninput="changeInput()">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="referralAmount" id="referralAmount">Referral Amount</label>
                                    <input type="number" class="form-control" name="refferalAmount" id="referralAmount" placeholder="Referral Amount">
                                </div>
                            </div>
                        </div>
                    <div class="row">
                        <div class="form-group">
                                        <label for="referralType">Referral Type</label>
                                        <select class="form-group" name="referral_type" id="referralType">undefined
                                            <option value="Walkin">Walkin</option>
                                            <option value="Old Patient">Old Patient</option>
                                            <option value="Cross Referral">Cross Referral</option>
                                            <option value="Self">Self</option>
                                            <option value="Marketing Executive">Marketing Executive</option>
                                            <option value="Visiting Consultant">Visiting Consultant</option>
                                            <option value="Referral" selected="">Referral</option>
                                        </select>
                                    </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="referralAmount">Referral Payment Mode</label>
                                     <label for="referralType">Referral Type</label>
                                    <select class="form-control" name="referral_type" id="referralType">
                                        <option value="" selected>Cheque</option>
                                        <option value="">UPI</option>
                                        <option value="">Cash</option>
                                        <option value="">Net Banking</option>
                                    </select>
                                </div>
                            </div>
                        <div class="col-md-6">
                                <div class="form-group">
{#                                    <label for="referralAmount">UPI</label>#}
                                    <input type="number" class="form-control" name="referralamount" id="referralAmount" hidden>
                                </div>
                            </div>

                        </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

                    <button type="button" class="btn btn-warning">Save changes</button>
                </div>
            </div>
        </div>
    </div>
 </div>
{% endblock %}